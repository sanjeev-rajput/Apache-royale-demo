/**
 * Generated by Apache Royale Compiler from views/actionitemviews/collaboration/CollaborationMain.mxml
 * views.actionitemviews.collaboration.CollaborationMain
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('views.actionitemviews.collaboration.CollaborationMain');
/* Royale Dependency List: org.apache.royale.jewel.HGroup,org.apache.royale.jewel.supportClasses.scrollbar.ScrollingViewport,com.unhurdle.spectrum.TextField,com.unhurdle.spectrum.Label,org.apache.royale.jewel.List,com.unhurdle.spectrum.Switch,org.apache.royale.collections.ArrayList,org.apache.royale.events.Event,org.apache.royale.events.MouseEvent,org.apache.royale.events.ValueEvent,views.actionitemviews.collaboration.SocketMessageHandler,views.actionitemviews.collaboration.SocketVideoHandler,views.actionitemviews.websocket.SocketService,XML*/

goog.require('org.apache.royale.jewel.VGroup');



/**
 * @constructor
 * @extends {org.apache.royale.jewel.VGroup}
 */
views.actionitemviews.collaboration.CollaborationMain = function() {
  views.actionitemviews.collaboration.CollaborationMain.base(this, 'constructor');
  
  /**
   * @private
   * @type {org.apache.royale.jewel.HGroup}
   */
  this.$ID_13_4;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.VGroup}
   */
  this.$ID_13_1;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.VGroup}
   */
  this.outputContainer_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.supportClasses.scrollbar.ScrollingViewport}
   */
  this.$ID_13_0;
  
  /**
   * @private
   * @type {com.unhurdle.spectrum.TextField}
   */
  this.input_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.VGroup}
   */
  this.$ID_13_3;
  
  /**
   * @private
   * @type {com.unhurdle.spectrum.Label}
   */
  this.usrNos_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.List}
   */
  this.userList_;
  
  /**
   * @private
   * @type {com.unhurdle.spectrum.Switch}
   */
  this.shareCamBtn_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.VGroup}
   */
  this.uVidContainer_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.supportClasses.scrollbar.ScrollingViewport}
   */
  this.$ID_13_2;
  
  /**
   * @private
   * @type {Array}
   */
  this.mxmldd;
  
  /**
   * @private
   * @type {Array}
   */
  this.mxmldp;

  this.generateMXMLAttributes([
    3,
    'percentWidth',
    true,
    100.0,
    'percentHeight',
    true,
    100.0,
    'className',
    true,
    'collaborativeContainer',
    0,
    1,
    'initComplete',
    this.$EH_13_0
  ]);
  
};
goog.inherits(views.actionitemviews.collaboration.CollaborationMain, org.apache.royale.jewel.VGroup);




/**
 * @private
 * @type {views.actionitemviews.websocket.SocketService}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain__socketService = null;


/**
 * @private
 * @type {views.actionitemviews.collaboration.SocketMessageHandler}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain__socketMsgHandler = null;


/**
 * @private
 * @type {views.actionitemviews.collaboration.SocketVideoHandler}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler = null;


/**
 * @type {string}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.myUserId = null;


/**
 * @private
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain_init = function() {
  this.views_actionitemviews_collaboration_CollaborationMain__socketService = new views.actionitemviews.websocket.SocketService();
  this.views_actionitemviews_collaboration_CollaborationMain__socketService.addCAllBackFunction(org.apache.royale.utils.Language.closure(this.views_actionitemviews_collaboration_CollaborationMain_onSocketData, this, 'views_actionitemviews_collaboration_CollaborationMain_onSocketData'));
  this.views_actionitemviews_collaboration_CollaborationMain__socketService.connectWebSocket(views.actionitemviews.websocket.SocketService.SUBSCRIBE_COLLABARATION);
  this.views_actionitemviews_collaboration_CollaborationMain__socketMsgHandler = new views.actionitemviews.collaboration.SocketMessageHandler(this.input, this.outputContainer);
  this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler = new views.actionitemviews.collaboration.SocketVideoHandler(this.uVidContainer, this.shareCamBtn, this.views_actionitemviews_collaboration_CollaborationMain__socketService);
};


/**
 * @private
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain_updateUserList = function() {
  if (this.userList.dataProvider && this.userList.dataProvider["length"] > 0) {
    var /** @type {org.apache.royale.collections.ArrayList} */ ulist = this.userList.dataProvider;
    var /** @type {number} */ idx = ulist.getItemIndex(this.myUserId);
    if (idx >= 0) {
      ulist.setItemAt(this.myUserId + " (You)", idx);
    }
    this.userList.dataProvider = ulist;
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.setUserList(this.userList);
  }
};


/**
 * @private
 * @param {Object} data
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain_onSocketData = function(data) {
  if (data["type"] == "video-offer") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.handleOffer(org.apache.royale.utils.Language.string(data["sender"]), data["offer"]);
  } else if (data["type"] == "video-answer") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.handleAnswer(org.apache.royale.utils.Language.string(data["sender"]), data["answer"]);
  } else if (data["type"] == "ice-candidate") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.handleCandidate(org.apache.royale.utils.Language.string(data["sender"]), data["candidate"]);
  } else if (data["type"] == "welcome") {
    this.myUserId = org.apache.royale.utils.Language.string(data["userId"]);
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.setMyUserId(this.myUserId);
    this.views_actionitemviews_collaboration_CollaborationMain__socketMsgHandler.handleWelcome(data);
    this.views_actionitemviews_collaboration_CollaborationMain_updateUserList();
  } else if (data["type"] == "user_list") {
    this.userList.dataProvider = new org.apache.royale.collections.ArrayList(data["users"]);
    this.usrNos.text = "Connected Users: " + data["count"] + "/" + data["max"];
    this.views_actionitemviews_collaboration_CollaborationMain_updateUserList();
  } else if (data["type"] == "subscribe_collabaration") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketMsgHandler.handleChatMessage(org.apache.royale.utils.Language.string(data["sender"]), org.apache.royale.utils.Language.string(data["text"]));
  } else if (data["type"] == "error") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketMsgHandler.handleError(org.apache.royale.utils.Language.string(data["message"]));
  } else if (data["type"] == "user_disconnected") {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.removePeerVideo(org.apache.royale.utils.Language.string(data["userId"]));
  }
};


/**
 * @private
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain_onInputChange = function() {
  var /** @type {string} */ msg = this.input.text;
  if (this.views_actionitemviews_collaboration_CollaborationMain__socketService && msg.length > 0) {
    this.views_actionitemviews_collaboration_CollaborationMain__socketService.sendToSocket({"type":views.actionitemviews.websocket.SocketService.SUBSCRIBE_COLLABARATION, "text":msg});
    this.input.text = "";
    this.input.focus();
  }
};


/**
 * @private
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.views_actionitemviews_collaboration_CollaborationMain_onShareWebcam = function() {
  var /** @type {boolean} */ flag = this.shareCamBtn.checked;
  if (flag) {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.onStartWebcam();
  } else {
    this.views_actionitemviews_collaboration_CollaborationMain__socketVideoHandler.onStopWebcam();
  }
};


/**
 * @export
 * @param {org.apache.royale.events.Event} event
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.$EH_13_0 = function(event)
{
  this.views_actionitemviews_collaboration_CollaborationMain_init();
};


/**
 * @export
 * @param {org.apache.royale.events.ValueEvent} event
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.$EH_13_1 = function(event)
{
  this.views_actionitemviews_collaboration_CollaborationMain_onInputChange();
};


/**
 * @export
 * @param {org.apache.royale.events.MouseEvent} event
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.$EH_13_2 = function(event)
{
  this.views_actionitemviews_collaboration_CollaborationMain_onShareWebcam();
};


Object.defineProperties(views.actionitemviews.collaboration.CollaborationMain.prototype, /** @lends {views.actionitemviews.collaboration.CollaborationMain.prototype} */ {
  outputContainer: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.outputContainer_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.outputContainer_) {
        this.outputContainer_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'outputContainer', null, value));
      }
    }
  },
  input: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.input_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.input_) {
        this.input_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'input', null, value));
      }
    }
  },
  usrNos: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.usrNos_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.usrNos_) {
        this.usrNos_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'usrNos', null, value));
      }
    }
  },
  userList: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.userList_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.userList_) {
        this.userList_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'userList', null, value));
      }
    }
  },
  shareCamBtn: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.shareCamBtn_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.shareCamBtn_) {
        this.shareCamBtn_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'shareCamBtn', null, value));
      }
    }
  },
  uVidContainer: {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      return this.uVidContainer_;
    },
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    set: function(value) {
      if (value != this.uVidContainer_) {
        this.uVidContainer_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'uVidContainer', null, value));
      }
    }
  },
  'MXMLDescriptor': {
    /** @this {views.actionitemviews.collaboration.CollaborationMain} */
    get: function() {
      if (this.mxmldd == undefined)
      {
        /** @type {Array} */
        var arr = views.actionitemviews.collaboration.CollaborationMain.superClass_.get__MXMLDescriptor.apply(this);
        /** @type {Array} */
        var mxmldd = [
          org.apache.royale.jewel.HGroup,
          4,
          '_id',
          true,
          '$ID_13_4',
          'percentHeight',
          true,
          100.0,
          'percentWidth',
          true,
          100.0,
          'gap',
          true,
          1,
          0,
          0,
          [
            org.apache.royale.jewel.VGroup,
            3,
            '_id',
            true,
            '$ID_13_1',
            'percentWidth',
            true,
            85.0,
            'percentHeight',
            true,
            100.0,
            0,
            0,
            [
              org.apache.royale.jewel.VGroup,
              6,
              'id',
              true,
              'outputContainer',
              'percentWidth',
              true,
              100.0,
              'percentHeight',
              true,
              100.0,
              'itemsVerticalAlign',
              true,
              'itemsTop',
              'gap',
              true,
              1,
              'beads',
              null,
              [
                org.apache.royale.jewel.supportClasses.scrollbar.ScrollingViewport,
                1,
                '_id',
                true,
                '$ID_13_0',
                0,
                0,
                null
              ],
              0,
              0,
              null,
              com.unhurdle.spectrum.TextField,
              4,
              'id',
              true,
              'input',
              'percentWidth',
              true,
              100.0,
              'placeholder',
              true,
              'Type your message here...',
              'style',
              true,
              'resize:none',
              0,
              1,
              'onEnter',
              this.$EH_13_1,
              null
            ],
            org.apache.royale.jewel.VGroup,
            6,
            '_id',
            true,
            '$ID_13_3',
            'style',
            true,
            'border:1px dashed gray;',
            'percentWidth',
            true,
            15.0,
            'percentHeight',
            true,
            100.0,
            'itemsVerticalAlign',
            true,
            'itemsTop',
            'gap',
            true,
            1,
            0,
            0,
            [
              com.unhurdle.spectrum.Label,
              3,
              'id',
              true,
              'usrNos',
              'text',
              true,
              'Connected Users:',
              'percentWidth',
              true,
              100.0,
              0,
              0,
              null,
              org.apache.royale.jewel.List,
              3,
              'id',
              true,
              'userList',
              'percentWidth',
              true,
              100.0,
              'percentHeight',
              true,
              50.0,
              0,
              0,
              null,
              com.unhurdle.spectrum.Switch,
              3,
              'id',
              true,
              'shareCamBtn',
              'offLabel',
              true,
              'Webcam Off',
              'onLabel',
              true,
              'Webcam On',
              0,
              1,
              'click',
              this.$EH_13_2,
              null,
              org.apache.royale.jewel.VGroup,
              4,
              'id',
              true,
              'uVidContainer',
              'percentWidth',
              true,
              100.0,
              'percentHeight',
              true,
              50.0,
              'beads',
              null,
              [
                org.apache.royale.jewel.supportClasses.scrollbar.ScrollingViewport,
                1,
                '_id',
                true,
                '$ID_13_2',
                0,
                0,
                null
              ],
              0,
              0,
              null
            ]
          ]
        ];
        if (arr)
          this.mxmldd = arr.concat(mxmldd);
        else
          this.mxmldd = mxmldd;
      }
      return this.mxmldd;
    }
  }
});
/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'CollaborationMain', qName: 'views.actionitemviews.collaboration.CollaborationMain', kind: 'class'  }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    variables: function () {
      return {
        'myUserId': { type: 'String', get_set: function (/** views.actionitemviews.collaboration.CollaborationMain */ inst, /** * */ v) {return v !== undefined ? inst.myUserId = v : inst.myUserId;}}
      };
    },
    accessors: function () {
      return {
        'outputContainer': { type: 'org.apache.royale.jewel.VGroup', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'},
        'input': { type: 'com.unhurdle.spectrum.TextField', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'},
        'usrNos': { type: 'com.unhurdle.spectrum.Label', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'},
        'userList': { type: 'org.apache.royale.jewel.List', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'},
        'shareCamBtn': { type: 'com.unhurdle.spectrum.Switch', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'},
        'uVidContainer': { type: 'org.apache.royale.jewel.VGroup', access: 'readwrite', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'}
      };
    },
    methods: function () {
      return {
        'CollaborationMain': { type: '', declaredBy: 'views.actionitemviews.collaboration.CollaborationMain'}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
views.actionitemviews.collaboration.CollaborationMain.prototype.ROYALE_COMPILE_FLAGS = 9;



//# sourceMappingURL=./CollaborationMain.js.map
