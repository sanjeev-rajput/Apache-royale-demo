/**
 * Generated by Apache Royale Compiler from views/actionitemviews/pexels/VideoStreamController.as
 * views.actionitemviews.pexels.VideoStreamController
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('views.actionitemviews.pexels.VideoStreamController');
/* Royale Dependency List: com.model.Config,com.model.ServiceLoader,com.util.AppAlert,org.apache.royale.events.Event,org.apache.royale.jewel.VideoPlayer,XML*/




/**
 * @constructor
 * @param {string=} defaultQuery
 * @param {number=} defaultPerPage
 */
views.actionitemviews.pexels.VideoStreamController = function(defaultQuery, defaultPerPage) {
  defaultQuery = typeof defaultQuery !== 'undefined' ? defaultQuery : "technology";
  defaultPerPage = typeof defaultPerPage !== 'undefined' ? defaultPerPage : 10;
  
  this.views_actionitemviews_pexels_VideoStreamController_sUrl = com.model.Config.apiBaseUrl;
  this.views_actionitemviews_pexels_VideoStreamController_query = defaultQuery;
  this.views_actionitemviews_pexels_VideoStreamController_perPage = defaultPerPage;
};


/**
 * @private
 * @type {string}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_sUrl = null;


/**
 * @private
 * @type {string}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_query = "technology";


/**
 * @private
 * @type {number}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_perPage = 10;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_currentPage = 1;


/**
 * @private
 * @type {boolean}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_isFetching = false;


/**
 * @private
 * @type {com.model.ServiceLoader}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_httpService = null;


/**
 * @private
 * @type {org.apache.royale.jewel.VideoPlayer}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer = null;


/**
 * @param {string=} newQuery
 */
views.actionitemviews.pexels.VideoStreamController.prototype.reset = function(newQuery) {
  newQuery = typeof newQuery !== 'undefined' ? newQuery : "technology";
  this.views_actionitemviews_pexels_VideoStreamController_query = newQuery;
  this.views_actionitemviews_pexels_VideoStreamController_currentPage = 1;
  this.views_actionitemviews_pexels_VideoStreamController_isFetching = false;
};


/**
 * @param {Function} onSuccess
 * @param {Function=} onError
 */
views.actionitemviews.pexels.VideoStreamController.prototype.fetchNextPage = function(onSuccess, onError) {
  var self = this;
  onError = typeof onError !== 'undefined' ? onError : null;
  if (this.views_actionitemviews_pexels_VideoStreamController_isFetching)
    return;
  this.views_actionitemviews_pexels_VideoStreamController_isFetching = true;
  if (this.views_actionitemviews_pexels_VideoStreamController_httpService) {
    this.views_actionitemviews_pexels_VideoStreamController_httpService.cancel();
    this.views_actionitemviews_pexels_VideoStreamController_httpService = null;
  }
  var /** @type {string} */ url = this.views_actionitemviews_pexels_VideoStreamController_sUrl + "pexels/videoStream?q=" + encodeURIComponent(this.views_actionitemviews_pexels_VideoStreamController_query) + "&per_page=" + this.views_actionitemviews_pexels_VideoStreamController_perPage + "&page=" + this.views_actionitemviews_pexels_VideoStreamController_currentPage;
  this.views_actionitemviews_pexels_VideoStreamController_httpService = new com.model.ServiceLoader();
  this.views_actionitemviews_pexels_VideoStreamController_httpService.reqMethod = "GET";
  this.views_actionitemviews_pexels_VideoStreamController_httpService.contentType = "application/json";
  this.views_actionitemviews_pexels_VideoStreamController_httpService.loadJData(url, function(data) {
    self.views_actionitemviews_pexels_VideoStreamController_isFetching = false;
    self.views_actionitemviews_pexels_VideoStreamController_currentPage++;
    if (onSuccess != null)
      onSuccess(data);
  }, com.model.ServiceLoader.DATA_TYPE_JSON, function(e) {
    self.views_actionitemviews_pexels_VideoStreamController_isFetching = false;
    if (onError != null) {
      onError(e);
    } else {
      com.util.AppAlert.show(com.util.AppAlert.ERROR, "Video loading failed");
    }
  }, false);
};


/**
 * @param {Object} video
 * @return {string}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.getBestVideoUrl = function(video) {
  var self = this;
  var /** @type {Object} */ best = video["video_files"]["find"](function(v) {
    return v["quality"] == "sd" && v["width"] <= 640;
  }) || video["video_files"][0];
  return org.apache.royale.utils.Language.string(best ? best["link"] : null);
};


/**
 * @param {string} link
 * @param {number=} width
 * @param {number=} height
 * @return {org.apache.royale.jewel.VideoPlayer}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.createVideoPlayer = function(link, width, height) {
  var self = this;
  width = typeof width !== 'undefined' ? width : 0;
  height = typeof height !== 'undefined' ? height : 0;
  var /** @type {org.apache.royale.jewel.VideoPlayer} */ player = new org.apache.royale.jewel.VideoPlayer();
  if (width > 0 || height > 0) {
    player.width = width;
    player.height = height;
  } else {
    player.percentWidth = 100;
    player.percentHeight = 100;
  }
  player.src = link;
  player.autoplay = false;
  player.controls = true;
  player.loop = true;
  player.addEventListener("play", function() {
    if (self.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer && self.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer != player) {
      self.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer.pause();
    }
    self.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer = player;
  });
  return player;
};


/**
 */
views.actionitemviews.pexels.VideoStreamController.prototype.dispose = function() {
  if (this.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer) {
    this.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer.pause();
    this.views_actionitemviews_pexels_VideoStreamController_currentPlayingPlayer = null;
  }
  if (this.views_actionitemviews_pexels_VideoStreamController_httpService) {
    this.views_actionitemviews_pexels_VideoStreamController_httpService.cancel();
    this.views_actionitemviews_pexels_VideoStreamController_httpService = null;
  }
  this.reset();
};


/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'VideoStreamController', qName: 'views.actionitemviews.pexels.VideoStreamController', kind: 'class' }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    methods: function () {
      return {
        'VideoStreamController': { type: '', declaredBy: 'views.actionitemviews.pexels.VideoStreamController', parameters: function () { return [ 'String', true ,'int', true ]; }},
        'reset': { type: 'void', declaredBy: 'views.actionitemviews.pexels.VideoStreamController', parameters: function () { return [ 'String', true ]; }},
        'fetchNextPage': { type: 'void', declaredBy: 'views.actionitemviews.pexels.VideoStreamController', parameters: function () { return [ 'Function', false ,'Function', true ]; }},
        'getBestVideoUrl': { type: 'String', declaredBy: 'views.actionitemviews.pexels.VideoStreamController', parameters: function () { return [ 'Object', false ]; }},
        'createVideoPlayer': { type: 'org.apache.royale.jewel.VideoPlayer', declaredBy: 'views.actionitemviews.pexels.VideoStreamController', parameters: function () { return [ 'String', false ,'int', true ,'int', true ]; }},
        'dispose': { type: 'void', declaredBy: 'views.actionitemviews.pexels.VideoStreamController'}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
views.actionitemviews.pexels.VideoStreamController.prototype.ROYALE_COMPILE_FLAGS = 9;

//# sourceMappingURL=./VideoStreamController.js.map
