/**
 * Generated by Apache Royale Compiler from views/actionitemviews/keybordgame/KeyGame.mxml
 * views.actionitemviews.keybordgame.KeyGame
 *
 * @fileoverview
 *
 * @suppress {missingRequire|checkTypes|accessControls}
 */

goog.provide('views.actionitemviews.keybordgame.KeyGame');
/* Royale Dependency List: org.apache.royale.svg.elements.Svg,org.apache.royale.svg.elements.Rect,org.apache.royale.jewel.Label,org.apache.royale.events.Event,org.apache.royale.events.KeyboardEvent,org.apache.royale.jewel.Image,org.apache.royale.utils.Timer,XML*/

goog.require('org.apache.royale.jewel.View');



/**
 * @constructor
 * @extends {org.apache.royale.jewel.View}
 */
views.actionitemviews.keybordgame.KeyGame = function() {
  views.actionitemviews.keybordgame.KeyGame.base(this, 'constructor');
  
  this.views_actionitemviews_keybordgame_KeyGame_balls = [];
  /**
   * @private
   * @type {org.apache.royale.svg.elements.Svg}
   */
  this.$ID_11_0;
  
  /**
   * @private
   * @type {org.apache.royale.svg.elements.Rect}
   */
  this.warningArea_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.Label}
   */
  this.gmOvr_;
  
  /**
   * @private
   * @type {org.apache.royale.jewel.Label}
   */
  this.scoreLabel_;
  
  /**
   * @private
   * @type {Array}
   */
  this.mxmldd;
  
  /**
   * @private
   * @type {Array}
   */
  this.mxmldp;

  this.generateMXMLAttributes([
    3,
    'width',
    true,
    800,
    'height',
    true,
    600,
    'className',
    true,
    'gameArea',
    0,
    1,
    'initComplete',
    this.$EH_11_0
  ]);
  
};
goog.inherits(views.actionitemviews.keybordgame.KeyGame, org.apache.royale.jewel.View);




/**
 * @private
 * @type {org.apache.royale.jewel.Image}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_basket = null;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_basketPosX = 350;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_basketSpeed = 30;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_basketPosY = 20;


/**
 * @private
 * @type {Array}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_balls = null;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_score = 0;


/**
 * @private
 * @type {org.apache.royale.utils.Timer}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_gameTimer = null;


/**
 * @private
 * @type {boolean}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_isGameOver = false;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_warningThickness = 2;


/**
 * @private
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_intervalId = 0;


/**
 * @private
 * @type {org.apache.royale.svg.elements.Rect}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame__shape = null;


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_init = function() {
  this.views_actionitemviews_keybordgame_KeyGame_createBasket();
  this.views_actionitemviews_keybordgame_KeyGame_setupKeyboardControls();
  this.views_actionitemviews_keybordgame_KeyGame_setupGameTimer();
  this.views_actionitemviews_keybordgame_KeyGame_intervalId = (setInterval(org.apache.royale.utils.Language.closure(this.views_actionitemviews_keybordgame_KeyGame_spawnBall, this, 'views_actionitemviews_keybordgame_KeyGame_spawnBall'), 2000)) >> 0;
  this.views_actionitemviews_keybordgame_KeyGame_updateWarningArea();
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_createBasket = function() {
  this.views_actionitemviews_keybordgame_KeyGame_basket = new org.apache.royale.jewel.Image();
  this.views_actionitemviews_keybordgame_KeyGame_basket.width = 100;
  this.views_actionitemviews_keybordgame_KeyGame_basket.height = 50;
  this.views_actionitemviews_keybordgame_KeyGame_basket.src = "img/basket.png";
  this.views_actionitemviews_keybordgame_KeyGame_basket.element.style.position = "absolute";
  this.views_actionitemviews_keybordgame_KeyGame_updateBasketPosition();
  this.views_actionitemviews_keybordgame_KeyGame_basket.element.style.transition = "left 0.2s linear";
  this.addElement(this.views_actionitemviews_keybordgame_KeyGame_basket);
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_setupKeyboardControls = function() {
  document.addEventListener(org.apache.royale.events.KeyboardEvent.KEY_DOWN, org.apache.royale.utils.Language.closure(this.views_actionitemviews_keybordgame_KeyGame_onKeyDown, this, 'views_actionitemviews_keybordgame_KeyGame_onKeyDown'));
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_setupGameTimer = function() {
  this.views_actionitemviews_keybordgame_KeyGame_gameTimer = new org.apache.royale.utils.Timer(30);
  this.views_actionitemviews_keybordgame_KeyGame_gameTimer.addEventListener("timer", org.apache.royale.utils.Language.closure(this.views_actionitemviews_keybordgame_KeyGame_onGameTick, this, 'views_actionitemviews_keybordgame_KeyGame_onGameTick'));
  this.views_actionitemviews_keybordgame_KeyGame_gameTimer.start();
};


/**
 * @private
 * @param {org.apache.royale.events.KeyboardEvent} e
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_onKeyDown = function(e) {
  if (this.views_actionitemviews_keybordgame_KeyGame_isGameOver)
    return;
  if (e.key == "ArrowLeft") {
    this.views_actionitemviews_keybordgame_KeyGame_basketPosX = (Math.max(0, this.views_actionitemviews_keybordgame_KeyGame_basketPosX - this.views_actionitemviews_keybordgame_KeyGame_basketSpeed)) >> 0;
  } else if (e.key == "ArrowRight") {
    this.views_actionitemviews_keybordgame_KeyGame_basketPosX = (Math.min(this.width - this.views_actionitemviews_keybordgame_KeyGame_basket.width, this.views_actionitemviews_keybordgame_KeyGame_basketPosX + this.views_actionitemviews_keybordgame_KeyGame_basketSpeed)) >> 0;
  }
  this.views_actionitemviews_keybordgame_KeyGame_updateBasketPosition();
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_spawnBall = function() {
  if (this.views_actionitemviews_keybordgame_KeyGame_isGameOver) {
    clearInterval(this.views_actionitemviews_keybordgame_KeyGame_intervalId);
    return;
  }
  var /** @type {org.apache.royale.jewel.Image} */ ball = new org.apache.royale.jewel.Image();
  ball.width = 30;
  ball.height = 30;
  ball.src = "img/ball.png";
  ball.element.style.position = "absolute";
  ball.element.style.left = (Math.random() * (this.width - ball.width)) + "px";
  ball.element.style.top = "0px";
  this.addElement(ball);
  this.views_actionitemviews_keybordgame_KeyGame_balls.push(ball);
};


/**
 * @private
 * @param {org.apache.royale.events.Event} event
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_onGameTick = function(event) {
  for (var /** @type {number} */ i = (this.views_actionitemviews_keybordgame_KeyGame_balls.length - 1) >> 0; i >= 0; i--) {
    var /** @type {org.apache.royale.jewel.Image} */ ball = /* implicit cast */ org.apache.royale.utils.Language.as(this.views_actionitemviews_keybordgame_KeyGame_balls[i], org.apache.royale.jewel.Image, true);
    var /** @type {number} */ currentTop = (parseInt(ball.element.style.top, 0) || 0) >> 0;
    currentTop += 5;
    ball.element.style.top = currentTop + "px";
    var /** @type {number} */ ballX = (parseInt(ball.element.style.left, 0) || 0) >> 0;
    var /** @type {number} */ ballY = currentTop;
    var /** @type {number} */ basketTop = (this.height - this.views_actionitemviews_keybordgame_KeyGame_basketPosY - this.views_actionitemviews_keybordgame_KeyGame_basket.height) >> 0;
    var /** @type {number} */ basketBottom = (this.height - this.views_actionitemviews_keybordgame_KeyGame_basketPosY) >> 0;
    if (ballY + ball.height >= basketTop && ballY <= basketBottom && ballX + ball.width > this.views_actionitemviews_keybordgame_KeyGame_basketPosX && ballX < this.views_actionitemviews_keybordgame_KeyGame_basketPosX + this.views_actionitemviews_keybordgame_KeyGame_basket.width) {
      this.views_actionitemviews_keybordgame_KeyGame_removeBall(ball, true);
    } else if (ballY > this.height) {
      this.views_actionitemviews_keybordgame_KeyGame_removeBall(ball, false);
    }
  }
};


/**
 * @private
 * @param {org.apache.royale.jewel.Image} ball
 * @param {boolean} isCatched
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_removeBall = function(ball, isCatched) {
  var self = this;
  var /** @type {number} */ ballX = (parseInt(ball.element.style.left, 0) || 0) >> 0;
  var /** @type {number} */ ballY = (parseInt(ball.element.style.top, 0) || 0) >> 0;
  if (isCatched) {
    this.views_actionitemviews_keybordgame_KeyGame_showPointsAnimation("+10", (this.views_actionitemviews_keybordgame_KeyGame_basketPosX + this.views_actionitemviews_keybordgame_KeyGame_basket.width / 2) >> 0, (this.height - (this.views_actionitemviews_keybordgame_KeyGame_basketPosY + this.views_actionitemviews_keybordgame_KeyGame_basket.height)) >> 0, "green");
    this.views_actionitemviews_keybordgame_KeyGame_basket.element.classList.add('gameBlurBasket');
    setTimeout(function() {
      self.views_actionitemviews_keybordgame_KeyGame_basket.element.classList.remove('gameBlurBasket');
    }, 200);
    this.views_actionitemviews_keybordgame_KeyGame_score += 10;
    this.removeElement(ball);
  } else {
    ball.src = "img/blast.png";
    this.views_actionitemviews_keybordgame_KeyGame_showPointsAnimation("-10", ballX, ballY, "red");
    this.views_actionitemviews_keybordgame_KeyGame_score -= 10;
    setTimeout(org.apache.royale.utils.Language.closure(this.removeElement, this, 'removeElement'), 500, ball);
    if (this.views_actionitemviews_keybordgame_KeyGame_score % -30 == 0) {
      this.views_actionitemviews_keybordgame_KeyGame_basketPosY += 20;
      this.views_actionitemviews_keybordgame_KeyGame_updateBasketPosition();
      this.views_actionitemviews_keybordgame_KeyGame_updateWarningArea();
    }
  }
  this.scoreLabel.text = "Score: " + this.views_actionitemviews_keybordgame_KeyGame_score;
  this.views_actionitemviews_keybordgame_KeyGame_balls.splice(this.views_actionitemviews_keybordgame_KeyGame_balls.indexOf(ball), 1);
};


/**
 * @private
 * @param {string} pointsText
 * @param {number} x
 * @param {number} y
 * @param {string} color
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_showPointsAnimation = function(pointsText, x, y, color) {
  var self = this;
  var /** @type {org.apache.royale.jewel.Label} */ pointsLabel = new org.apache.royale.jewel.Label();
  pointsLabel.text = pointsText;
  pointsLabel.element.style.position = "absolute";
  pointsLabel.element.style.left = x + "px";
  pointsLabel.element.style.top = y + "px";
  pointsLabel.element.style.color = color;
  pointsLabel.element.style.fontWeight = "bold";
  pointsLabel.element.style.transition = "top 1s ease-out, opacity 1s ease-out";
  this.addElement(pointsLabel);
  setTimeout(function() {
    pointsLabel.element.style.top = (y - 50) + "px";
    pointsLabel.element.style.opacity = "0";
  }, 10);
  setTimeout(function() {
    self.removeElement(pointsLabel);
  }, 200);
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_updateBasketPosition = function() {
  this.views_actionitemviews_keybordgame_KeyGame_basket.element.style.bottom = this.views_actionitemviews_keybordgame_KeyGame_basketPosY + "px";
  this.views_actionitemviews_keybordgame_KeyGame_basket.element.style.left = this.views_actionitemviews_keybordgame_KeyGame_basketPosX + "px";
  if (this.views_actionitemviews_keybordgame_KeyGame_basketPosY >= this.height - this.views_actionitemviews_keybordgame_KeyGame_basket.height - 50) {
    this.views_actionitemviews_keybordgame_KeyGame_isGameOver = true;
    this.views_actionitemviews_keybordgame_KeyGame_showGameOver();
  }
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_showGameOver = function() {
  this.gmOvr.visible = true;
  this.views_actionitemviews_keybordgame_KeyGame_gameTimer.stop();
};


/**
 * @private
 */
views.actionitemviews.keybordgame.KeyGame.prototype.views_actionitemviews_keybordgame_KeyGame_updateWarningArea = function() {
  this.warningArea.height = this.views_actionitemviews_keybordgame_KeyGame_basketPosY;
  this.warningArea.y = 600 - this.views_actionitemviews_keybordgame_KeyGame_basketPosY;
  if (this.views_actionitemviews_keybordgame_KeyGame_basketPosY >= this.height / 2) {
    this.warningArea.fill = 'yellow';
  }
  if (this.views_actionitemviews_keybordgame_KeyGame_basketPosY >= this.height - 200) {
    this.warningArea.fill = 'orange';
  }
};


/**
 * @export
 * @param {org.apache.royale.events.Event} event
 */
views.actionitemviews.keybordgame.KeyGame.prototype.$EH_11_0 = function(event)
{
  this.views_actionitemviews_keybordgame_KeyGame_init();
};


Object.defineProperties(views.actionitemviews.keybordgame.KeyGame.prototype, /** @lends {views.actionitemviews.keybordgame.KeyGame.prototype} */ {
  warningArea: {
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    get: function() {
      return this.warningArea_;
    },
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    set: function(value) {
      if (value != this.warningArea_) {
        this.warningArea_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'warningArea', null, value));
      }
    }
  },
  gmOvr: {
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    get: function() {
      return this.gmOvr_;
    },
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    set: function(value) {
      if (value != this.gmOvr_) {
        this.gmOvr_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'gmOvr', null, value));
      }
    }
  },
  scoreLabel: {
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    get: function() {
      return this.scoreLabel_;
    },
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    set: function(value) {
      if (value != this.scoreLabel_) {
        this.scoreLabel_ = value;
        this.dispatchEvent(org.apache.royale.events.ValueChangeEvent.createUpdateEvent(this, 'scoreLabel', null, value));
      }
    }
  },
  'MXMLDescriptor': {
    /** @this {views.actionitemviews.keybordgame.KeyGame} */
    get: function() {
      if (this.mxmldd == undefined)
      {
        /** @type {Array} */
        var arr = views.actionitemviews.keybordgame.KeyGame.superClass_.get__MXMLDescriptor.apply(this);
        /** @type {Array} */
        var mxmldd = [
          org.apache.royale.svg.elements.Svg,
          3,
          '_id',
          true,
          '$ID_11_0',
          'percentWidth',
          true,
          100,
          'percentHeight',
          true,
          100,
          0,
          0,
          [
            org.apache.royale.svg.elements.Rect,
            6,
            'id',
            true,
            'warningArea',
            'percentWidth',
            true,
            100,
            'height',
            true,
            10,
            'x',
            true,
            0,
            'y',
            true,
            600,
            'fill',
            true,
            'green',
            0,
            0,
            null
          ],
          org.apache.royale.jewel.Label,
          4,
          'id',
          true,
          'gmOvr',
          'text',
          true,
          'GAME OVER',
          'className',
          true,
          'gameOverLbl',
          'visible',
          true,
          false,
          0,
          0,
          null,
          org.apache.royale.jewel.Label,
          3,
          'id',
          true,
          'scoreLabel',
          'text',
          true,
          'Score: 00',
          'className',
          true,
          'scoreLbl',
          0,
          0,
          null
        ];
        if (arr)
          this.mxmldd = arr.concat(mxmldd);
        else
          this.mxmldd = mxmldd;
      }
      return this.mxmldd;
    }
  }
});
/**
 * Metadata
 *
 * @type {Object.<string, Array.<Object>>}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.ROYALE_CLASS_INFO = { names: [{ name: 'KeyGame', qName: 'views.actionitemviews.keybordgame.KeyGame', kind: 'class'  }] };



/**
 * Reflection
 *
 * @return {Object.<string, Function>}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.ROYALE_REFLECTION_INFO = function () {
  return {
    accessors: function () {
      return {
        'warningArea': { type: 'org.apache.royale.svg.elements.Rect', access: 'readwrite', declaredBy: 'views.actionitemviews.keybordgame.KeyGame'},
        'gmOvr': { type: 'org.apache.royale.jewel.Label', access: 'readwrite', declaredBy: 'views.actionitemviews.keybordgame.KeyGame'},
        'scoreLabel': { type: 'org.apache.royale.jewel.Label', access: 'readwrite', declaredBy: 'views.actionitemviews.keybordgame.KeyGame'}
      };
    },
    methods: function () {
      return {
        'KeyGame': { type: '', declaredBy: 'views.actionitemviews.keybordgame.KeyGame'}
      };
    }
  };
};
/**
 * @const
 * @type {number}
 */
views.actionitemviews.keybordgame.KeyGame.prototype.ROYALE_COMPILE_FLAGS = 9;
